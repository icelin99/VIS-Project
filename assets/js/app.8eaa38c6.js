(function(){"use strict";var t={5114:function(t,e,i){var n=i(5130),r=i(6768);const a={id:"app"},s={class:"main-container"},o={class:"left-panel"},l={class:"left-top-container"},d={class:"filter-panel"},c={class:"fdg-container"},h={class:"left-bottom-container"},p={class:"subgraphs-container"},u={class:"right-panel"},g={class:"network-wrapper"},f={class:"parallel-wrapper"};function m(t,e,i,n,m,y){const v=(0,r.g2)("FilterPanel"),k=(0,r.g2)("FDG"),w=(0,r.g2)("SubGraphs"),b=(0,r.g2)("NetworkGraph"),C=(0,r.g2)("ParallelCoordinates");return(0,r.uX)(),(0,r.CE)("div",a,[e[0]||(e[0]=(0,r.Lk)("div",{class:"header-container"},[(0,r.Lk)("h1",{class:"title"},"Vast Challenge 2023 MC1")],-1)),(0,r.Lk)("div",s,[(0,r.Lk)("div",o,[(0,r.Lk)("div",l,[(0,r.Lk)("div",d,[(0,r.bF)(v)]),(0,r.Lk)("div",c,[(0,r.bF)(k)])]),(0,r.Lk)("div",h,[(0,r.Lk)("div",p,[(0,r.bF)(w)])])]),(0,r.Lk)("div",u,[(0,r.Lk)("div",g,[(0,r.bF)(b)]),(0,r.Lk)("div",f,[(0,r.bF)(C,{nodes:t.coefData},null,8,["nodes"])])])])])}var y=i(4232);const v={class:"filter-panel-container"},k={class:"filter-item"},w={class:"checkbox-container"},b=["value"],C={key:0,class:"filter-item"};function x(t,e,i,a,s,o){const l=(0,r.g2)("el-checkbox"),d=(0,r.g2)("el-option"),c=(0,r.g2)("el-select");return(0,r.uX)(),(0,r.CE)("div",v,[(0,r.Lk)("div",k,[e[3]||(e[3]=(0,r.Lk)("h3",null,"Select Node",-1)),(0,r.Lk)("div",w,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.nodes,(t=>((0,r.uX)(),(0,r.CE)("label",{class:"checkbox-item",key:t.value},[(0,r.bo)((0,r.Lk)("input",{type:"checkbox","onUpdate:modelValue":e[0]||(e[0]=t=>s.selectedNodes=t),value:t.value},null,8,b),[[n.lH,s.selectedNodes]]),(0,r.Lk)("span",null,(0,y.v_)(t.label),1),(0,r.Lk)("span",{class:"type-color-dot",style:(0,y.Tr)({backgroundColor:s.typeColors[t.value]})},null,4)])))),128))])]),s.mounted?((0,r.uX)(),(0,r.CE)("div",C,[e[5]||(e[5]=(0,r.Lk)("h3",null,"Select Country",-1)),(0,r.bF)(c,{modelValue:s.selectedCountries,"onUpdate:modelValue":e[2]||(e[2]=t=>s.selectedCountries=t),multiple:"",clearable:"","collapse-tags":"","max-collapse-tags":3,placeholder:"Select countries","popper-class":"custom-header",class:"country-select",teleported:!1,"fit-input-width":!0,"popper-append-to-body":!1,"reserve-keyword":!1,popperOptions:{modifiers:[{name:"computeStyles",options:{adaptive:!1,gpuAcceleration:!1}}]}},{header:(0,r.k6)((()=>[(0,r.bF)(l,{modelValue:s.checkAll,"onUpdate:modelValue":e[1]||(e[1]=t=>s.checkAll=t),indeterminate:s.indeterminate,onChange:o.handleCheckAll},{default:(0,r.k6)((()=>e[4]||(e[4]=[(0,r.eW)(" All ")]))),_:1},8,["modelValue","indeterminate","onChange"])])),default:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(t.countries,(t=>((0,r.uX)(),(0,r.Wv)(d,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])):(0,r.Q3)("",!0)])}i(8111),i(1701),i(7642),i(8004),i(3853),i(5876),i(2475),i(5024),i(1698);var A=i(782),L=i(6018),$=i(850),E={name:"FilterPanel",components:{ElSelect:L.AV,ElOption:L.P9,ElCheckbox:$.dI},computed:{...(0,A.aH)(["originalNodes","countries"]),nodeTypes(){return[...new Set(this.originalNodes.map((t=>t.type)))].filter(Boolean).map((t=>({value:t,label:t})))}},data(){return{mounted:!1,selectedNodes:["person","organization"],selectedRelations:[],selectedCountries:[],checkAll:!1,indeterminate:!1,typeColors:{person:"#FFB6C1",organization:"#4ECDC4",company:"#45B7D1",political_organization:"#96CEB4",location:"#FFEEAD",vessel:"#D4A5A5",event:"#9B59B6",movement:"#3498DB",unknown:"#95A5A6"},nodes:[{value:"person",label:"Person"},{value:"organization",label:"Organization"},{value:"company",label:"Company"},{value:"political_organization",label:"Political Organization"},{value:"location",label:"Location"},{value:"vessel",label:"Vessel"},{value:"event",label:"Event"},{value:"movement",label:"Movement"},{value:"unknown",label:"Unknown"}],relations:[{value:"membership",label:"Membership"},{value:"partnership",label:"Partnership"},{value:"ownership",label:"Ownership"},{value:"family relationship",label:"Family Relationship"}]}},mounted(){this.$nextTick((()=>{this.mounted=!0}))},watch:{selectedNodes(){console.log("selectedNodes-------",this.selectedNodes),this.handleFilterChange()},selectedRelations(){this.handleFilterChange()},selectedCountries:{handler(t){0===t.length?(this.checkAll=!1,this.indeterminate=!1):t.length===this.countries.length?(this.checkAll=!0,this.indeterminate=!1):this.indeterminate=!0,this.handleFilterChange()},deep:!0},countries:{immediate:!0,handler(t){t&&t.length>0&&(this.selectedCountries=t.map((t=>t.value)),this.checkAll=!0)}}},methods:{...(0,A.i0)(["applyFilters"]),handleCheckAll(t){this.indeterminate=!1,this.selectedCountries=t?this.countries.map((t=>t.value)):[]},handleFilterChange(){this.$store.commit("setFilterConditions",{nodeTypes:this.selectedNodes,countries:this.selectedCountries}),console.log("更新筛选条件",this.selectedNodes,this.selectedCountries),this.applyFilters()}}},F=i(1241);const N=(0,F.A)(E,[["render",x],["__scopeId","data-v-fc330070"]]);var S=N;const D={class:"visualization-panel"};function T(t,e,i,n,a,s){return(0,r.uX)(),(0,r.CE)("div",D,e[0]||(e[0]=[(0,r.Lk)("div",{class:"vis-container"},[(0,r.Lk)("div",{id:"force-directed-graph"}),(0,r.Lk)("div",{id:"graph-tooltip"})],-1)]))}i(4114),i(2489),i(7588);var _=i(3577),B={name:"FDG",computed:{...(0,A.aH)(["filteredNodes","filteredLinks","selectedNodeId"])},data(){return{simulation:null,svg:null,width:0,height:0,currentNodes:[],typeColors:{person:"#FFB6C1",organization:"#4ECDC4",company:"#45B7D1",political_organization:"#96CEB4",location:"#FFEEAD",vessel:"#D4A5A5",event:"#9B59B6",movement:"#3498DB",unknown:"#95A5A6"},linkColors:{membership:"#B0C4DE",partnership:"#A8D4B2",ownership:"#C7B8E0",family_relationship:"#C2B8A3"}}},mounted(){const t=document.getElementById("force-directed-graph");this.width=t.clientWidth,this.height=t.clientHeight,this.initGraph(),this.handleResize(),window.addEventListener("resize",this.handleResize)},beforeUnmount(){window.removeEventListener("resize",this.handleResize)},watch:{filteredNodes:{handler(t){t&&t.length>0&&this.updateVisualization()},immediate:!0},selectedNodeId:{handler(t){this.svg.selectAll(".node circle").transition().duration(200).style("stroke",(e=>e.id===t?"#FF0000":"#fff")).style("stroke-width",(e=>e.id===t?3:1.5))}}},methods:{handleResize(){const t=document.getElementById("force-directed-graph");this.width=t.clientWidth,this.height=t.clientHeight,this.svg.attr("width",this.width).attr("height",this.height),this.simulation&&(this.simulation.force("center",_.jTM(this.width/2,this.height/2)),this.simulation.alpha(.3).restart())},initGraph(){const t=document.getElementById("force-directed-graph");this.width=t.clientWidth,this.height=t.clientHeight,this.svg=_.Ltv("#force-directed-graph").append("svg").attr("width",this.width).attr("height",this.height),this.svg.append("g").attr("class","graph-container"),this.svg.call(_.s_O().scaleExtent([.1,4]).on("zoom",(t=>{this.svg.select(".graph-container").attr("transform",t.transform)})))},createGraph(){const t=this.filteredNodes,e=this.filteredLinks,i=this.filteredNodes.map((t=>t.linkCount)),n=Math.max(...i),r=Math.min(...i),a=_.m4Y().domain([r,n]).range([5,20]);console.log("节点连接数统计：",{maxLinks:n,minLinks:r,nodeCounts:this.filteredNodes.sort(((t,e)=>e.linkCount-t.linkCount)).slice(0,10).map((t=>({id:t.id,count:t.linkCount})))});const s=e.map((t=>t.weight)),o=Math.max(...s),l=Math.min(...s);console.log("边的权重范围：",{minWeight:l,maxWeight:o});const d=_.m4Y().domain([l,o]).range([150,50]);this.simulation=_.tXi(t).force("link",_.kJC(e).id((t=>t.id)).distance((t=>d(t.weight))).strength(.5)).force("charge",_.xJS().strength((t=>t.linkCount<15?-30:-100)).distanceMin(10).distanceMax(200)).force("center",_.jTM(this.width/2,this.height/2)).force("collision",_.eRw().radius((t=>a(t.linkCount)+5)).strength(.5)).force("x",_.KS8(this.width/2).strength(.02)).force("y",_.TSS(this.height/2).strength(.02)).alpha(1).alphaDecay(.01).velocityDecay(.3).restart(),t.forEach((t=>{t.fx=null,t.fy=null}));const c=this.svg.select(".graph-container"),h=this,p=c.selectAll(".link").data(e).enter().append("line").attr("class","link").style("stroke",(t=>t.weight>.99?"#FF0000":h.linkColors[t.type])).style("stroke-opacity",(t=>t.weight>.99?.8:.3)).style("stroke-width",(t=>t.weight>.99?4*t.weight:2*t.weight)).on("mouseover",((t,e)=>{_.Ltv(t.target).style("stroke-opacity",1).style("stroke",(t=>t.weight>.99?"#FF0000":h.linkColors[t.type]));const i=c.selectAll(".node").filter((t=>t.id===e.source.id||t.id===e.target.id));i.each(((t,e,i)=>{const n=_.Ltv(i[e]);n.select("circle").transition().duration(200).attr("r",(t=>1.5*a(t.linkCount))),n.select("text").transition().duration(200).style("font-weight","bold")}));const n=_.Ltv("#graph-tooltip");n.style("display","block").html(`\n                            <div class="tooltip-content">\n                                <div>Source: ${e.source.id}</div>\n                                <div>Target: ${e.target.id}</div>\n                                <div>Type: ${e.type||"Unknown"}</div>\n                                <div>Weight: ${e.weight?.toFixed(4)||"N/A"}</div>\n                                <div>Distance: ${d(e.weight)?.toFixed(4)||"N/A"}</div>\n                                <div>Color: ${h.linkColors[e.type]||"#999"}</div>\n                            </div>\n                        `).style("left",t.pageX+10+"px").style("top",t.pageY-10+"px")})).on("mouseout",((t,e)=>{_.Ltv(t.target).style("stroke-opacity",.3);const i=c.selectAll(".node").filter((t=>t.id===e.source.id||t.id===e.target.id));i.each(((t,e,i)=>{const s=_.Ltv(i[e]);s.select("circle").transition().duration(200).attr("r",(t=>a(t.linkCount))),s.select("text").transition().duration(200).style("font-size",(t=>{const e=(t.linkCount-r)/(n-r)*4+8;return`${e}px`})).style("font-weight","normal")})),_.Ltv("#graph-tooltip").style("display","none")})),u=c.selectAll(".node").data(t).enter().append("g").attr("class","node").call(_.$Er().on("start",this.dragStarted).on("drag",this.dragged).on("end",this.dragEnded)).on("click",this.handleNodeClick).on("dblclick",((t,e)=>{t.preventDefault();const i=this.findCycles(e.id);i.length>0?this.highlightCycles(i,e.id):this.clearHighlights()}));u.append("circle").attr("r",(t=>a(t.linkCount))).style("fill",(t=>this.typeColors[t.type]||"#95A5A6")).style("stroke",(t=>t.id===this.selectedNodeId?"#FF0000":"#fff")).style("stroke-width",(t=>t.id===this.selectedNodeId?3:1.5)),u.on("mouseover",((t,e)=>{const i=_.Ltv(t.currentTarget);i.select("circle").transition().duration(200).attr("r",(t=>1.5*a(t.linkCount))),i.select("text").transition().duration(200).style("font-weight","bold");const n=c.selectAll(".link").filter((t=>t.source.id===e.id||t.target.id===e.id));n.style("stroke-opacity",1).style("stroke",(t=>t.weight>.99?"#FF0000":h.linkColors[t.type]));const r=_.Ltv("#graph-tooltip");r.style("display","block").html(`\n                        <div class="tooltip-content">\n                            <div>ID: ${e.id}</div>\n                            <div>Type: ${e.type||"Unknown"}</div>\n                            <div>Country: ${e.country||"N/A"}</div>\n                            <div>Connections: ${e.linkCount}</div>\n                        </div>\n                    `).style("left",t.pageX+10+"px").style("top",t.pageY-10+"px")})).on("mouseout",((t,e)=>{const i=_.Ltv(t.currentTarget);i.select("circle").transition().duration(200).attr("r",(t=>a(t.linkCount))),i.select("text").transition().duration(200).style("font-size",(t=>{const e=(t.linkCount-r)/(n-r)*4+8;return`${e}px`})).style("font-weight","normal");const s=c.selectAll(".link").filter((t=>t.source.id===e.id||t.target.id===e.id));s.style("stroke-opacity",(t=>t.weight>.99?.8:.3)).style("stroke",(t=>t.weight>.99?"#FF0000":h.linkColors[t.type])),_.Ltv("#graph-tooltip").style("display","none")})),this.simulation.on("tick",(()=>{p.attr("x1",(t=>t.source.x)).attr("y1",(t=>t.source.y)).attr("x2",(t=>t.target.x)).attr("y2",(t=>t.target.y)),u.attr("transform",(t=>`translate(${t.x}, ${t.y})`))}))},dragStarted(t,e){t.active||this.simulation.alphaTarget(.3).restart(),e.fx=e.x,e.fy=e.y},dragged(t,e){e.fx=t.x,e.fy=t.y},dragEnded(t,e){t.active||this.simulation.alphaTarget(0),e.fx=null,e.fy=null},updateVisualization(){this.simulation&&this.simulation.stop(),_.Ltv(".graph-container").selectAll("*").remove(),this.filteredNodes.length>0&&(console.log("更新FDG"),this.createGraph())},handleNodeClick(t,e){this.$store.commit("setSelectedNodeId",e.id);const i=this.svg.select(".graph-container");i.selectAll(".link").transition().duration(200).style("stroke-opacity",(t=>t.source.id===e.id||t.target.id===e.id?t.weight>.99?1:.8:t.weight>.99?.8:.3)).style("stroke-width",(t=>t.source.id===e.id||t.target.id===e.id?t.weight>.99?6*t.weight:4*t.weight:t.weight>.99?4*t.weight:2*t.weight))},findCycles(t){const e=new Set,i=[],n=[],r=new Set,a=new Map;this.filteredLinks.forEach((t=>{a.has(t.source.id)||a.set(t.source.id,[]),a.has(t.target.id)||a.set(t.target.id,[]),a.get(t.source.id).push({node:t.target.id,link:t}),a.get(t.target.id).push({node:t.source.id,link:t})}));const s=(t,o)=>{e.add(t),n.push(t),r.add(t);const l=a.get(t)||[];for(const a of l)if(a.node!==o)if(r.has(a.node)){const t=n.indexOf(a.node),e=n.slice(t);e.push(a.node),i.push(e)}else e.has(a.node)||s(a.node,t);n.pop(),r.delete(t)};return s(t,null),i},highlightCycles(t,e){const i=this.svg.select(".graph-container"),n=new Set(t.flat()),r=new Set;i.selectAll(".node circle").transition().duration(200).style("stroke","#fff").style("stroke-width",1.5),i.selectAll(".link").transition().duration(200).style("stroke-opacity",(t=>t.weight>.99?.8:.3)).style("stroke-width",(t=>t.weight>.99?4*t.weight:2*t.weight)),t.forEach((t=>{for(let e=0;e<t.length-1;e++)r.add(`${t[e]}-${t[e+1]}`),r.add(`${t[e+1]}-${t[e]}`)})),i.selectAll(".node circle").transition().duration(200).style("stroke",(t=>t.id===e?"#FF0000":n.has(t.id)?"#FFD700":"#fff")).style("stroke-width",(t=>n.has(t.id)?3:1.5)),i.selectAll(".link").transition().duration(200).style("stroke-opacity",(t=>{const e=`${t.source.id}-${t.target.id}`,i=`${t.target.id}-${t.source.id}`;return r.has(e)||r.has(i)?1:.3})).style("stroke-width",(t=>{const e=`${t.source.id}-${t.target.id}`,i=`${t.target.id}-${t.source.id}`;return r.has(e)||r.has(i),t.weight>.99?4*t.weight:2*t.weight}))},clearHighlights(){const t=this.svg.select(".graph-container");t.selectAll(".node circle").transition().duration(200).style("stroke","#fff").style("stroke-width",1.5),t.selectAll(".link").transition().duration(200).style("stroke-opacity",(t=>t.weight>.99?.8:.3)).style("stroke-width",(t=>t.weight>.99?4*t.weight:2*t.weight))}}};const z=(0,F.A)(B,[["render",T],["__scopeId","data-v-13996a30"]]);var I=z;const j={class:"subgraphs-container"};function M(t,e,i,n,a,s){return(0,r.uX)(),(0,r.CE)("div",j,e[0]||(e[0]=[(0,r.Fv)('<div class="subgraph" data-v-63ea188a><div id="subgraph-membership" class="subgraph-vis" data-v-63ea188a></div></div><div class="subgraph" data-v-63ea188a><div id="subgraph-partnership" class="subgraph-vis" data-v-63ea188a></div></div><div class="subgraph" data-v-63ea188a><div id="subgraph-ownership" class="subgraph-vis" data-v-63ea188a></div></div><div class="subgraph" data-v-63ea188a><div id="subgraph-family-relationship" class="subgraph-vis" data-v-63ea188a></div></div><div id="subgraph-tooltip" data-v-63ea188a></div>',5)]))}var O={name:"SubGraphs",data(){return{simulations:{},svgs:{},width:0,height:0,linkTypes:["membership","partnership","ownership","family_relationship"],linkColors:{membership:"#B0C4DE",partnership:"#A8D4B2",ownership:"#C7B8E0",family_relationship:"#C2B8A3"},typeColors:{person:"#FFB6C1",organization:"#4ECDC4",company:"#45B7D1",political_organization:"#96CEB4",location:"#FFEEAD",vessel:"#D4A5A5",event:"#9B59B6",movement:"#3498DB",unknown:"#95A5A6"}}},computed:{...(0,A.aH)(["filteredNodes","filteredLinks","links","nodes","selectedNodeId"])},methods:{formatType(t){return t.split(" ").map((t=>t.charAt(0).toUpperCase()+t.slice(1))).join(" ")},handleResize(){const t=document.getElementById("subgraph-membership"),e=document.getElementById("subgraph-partnership"),i=document.getElementById("subgraph-ownership"),n=document.getElementById("subgraph-family-relationship"),r={membership:t,partnership:e,ownership:i,family_relationship:n};Object.entries(r).forEach((([t,e])=>{if(e){const i=e.clientWidth,n=e.clientHeight;this.svgs[t]&&(this.svgs[t].attr("width",i).attr("height",n),this.simulations[t]&&this.simulations[t].force("center",_.jTM(i/2,n/2)).alpha(.3).restart())}}))},async initSubgraphs(){await this.$nextTick();const t=[{type:"membership",id:"subgraph-membership"},{type:"partnership",id:"subgraph-partnership"},{type:"ownership",id:"subgraph-ownership"},{type:"family_relationship",id:"subgraph-family-relationship"}];Object.values(this.simulations).forEach((t=>{t&&t.stop()})),this.simulations={},t.forEach((({type:t,id:e})=>{const i=_.Ltv(`#${e}`),n=i.node();if(!n)return void console.warn(`Container for ${t} not found`);i.selectAll("svg").remove();const r=n.clientWidth||300,a=n.clientHeight||200,s=i.append("svg").attr("width","100%").attr("height","100%").attr("viewBox",`0 0 ${r} ${a}`).attr("preserveAspectRatio","xMidYMid meet").style("display","block");s.append("text").attr("x",r/2).attr("y",15).attr("text-anchor","middle").attr("dominant-baseline","middle").style("font-size","10px").style("font-weight","bold").text(this.formatType(t));const o=s.append("g").attr("class","graph-container").attr("transform","translate(0, 25)");s.call(_.s_O().scaleExtent([.5,4]).on("zoom",(t=>{o.attr("transform",t.transform)}))),this.svgs[t]=s}))},updateSubgraphs(){this.filteredNodes&&this.filteredLinks?(Object.values(this.simulations).forEach((t=>{t&&(t.stop(),t.nodes().forEach((t=>{t.fx=null,t.fy=null})))})),this.linkTypes.forEach((t=>{const e=this.filteredLinks.filter((e=>e.type===t));console.log(t,"links",e);const i=new Set;e.forEach((t=>{i.add("object"===typeof t.source?t.source.id:t.source),i.add("object"===typeof t.target?t.target.id:t.target)})),console.log(t,"nodeIds",i);const n=this.filteredNodes.filter((t=>i.has(t.id)));console.log(t,"nodes",n);const r=n.map((t=>t.linkCount)),a=Math.max(...r),s=Math.min(...r),o=_.m4Y().domain([s,a]).range([3,10]),l=this.svgs[t];if(!l)return void console.warn(`SVG for ${t} not found`);const d=l.select(".graph-container"),c=l.node().clientWidth,h=l.node().clientHeight-20;d.selectAll("*").remove();const p=.35*Math.min(c,h),u=c/2,g=h/2,f=n.filter((t=>t.isConnected)),m=2*Math.PI/f.length;f.forEach(((t,e)=>{const i=e*m;t.x=u+p*Math.cos(i),t.y=g+p*Math.sin(i)}));const y=n.filter((t=>!t.isConnected)),v=1.5*p;y.forEach(((t,e)=>{const i=2*e*Math.PI/y.length;t.x=u+v*Math.cos(i),t.y=g+v*Math.sin(i)})),d.selectAll(".link").data(e).enter().append("path").attr("class","link").attr("d",(t=>{const e=t.source.x||u,i=t.source.y||g,n=t.target.x||u,r=t.target.y||g,a=n-e,s=r-i,o=1.5*Math.sqrt(a*a+s*s);return`M${e},${i}A${o},${o} 0 0,1 ${n},${r}`})).style("fill","none").style("stroke",(e=>e.weight>.99?"#FF0000":this.linkColors[t])).style("stroke-opacity",(t=>t.weight>.99?.8:.6)).style("stroke-width",(t=>t.weight>.99?3:t.weight>.7?2.5:t.weight>.4?2:t.weight>.2?1.5:1)).on("mouseover",((t,e)=>{_.Ltv(t.target).transition().duration(200).style("stroke-opacity",1).style("stroke-width",(t=>t.weight>.99?4*t.weight:2*t.weight)),d.selectAll(".node").filter((t=>t.id===e.source.id||t.id===e.target.id)).each(((t,e,i)=>{const n=_.Ltv(i[e]);n.select("circle").transition().duration(200).attr("r",(t=>1.5*o(t.linkCount)))}));const i=_.Ltv("#subgraph-tooltip");i.style("display","block").html(`\n                                <div class="tooltip-content">\n                                    <div data-label="Source">source: ${e.source.id}</div>\n                                    <div data-label="Target">target: ${e.target.id}</div>\n                                    <div data-label="Type">type: ${e.type||"Unknown"}</div>\n                                    <div data-label="Weight">weight: ${e.weight?.toFixed(4)||"N/A"}</div>\n                                </div>\n                            `).style("left",t.pageX+10+"px").style("top",t.pageY-10+"px")})).on("mouseout",((t,e)=>{_.Ltv(t.target).transition().duration(200).style("stroke-opacity",(t=>t.weight>.99?.8:.6)).style("stroke-width",(t=>t.weight>.99?3*t.weight:1.5*t.weight)),d.selectAll(".node").filter((t=>t.id===e.source.id||t.id===e.target.id)).each(((t,e,i)=>{const n=_.Ltv(i[e]);n.select("circle").transition().duration(200).attr("r",(t=>o(t.linkCount)))})),_.Ltv("#subgraph-tooltip").style("display","none")}));const k=d.selectAll(".node").data(n).enter().append("g").attr("class","node").attr("transform",(t=>`translate(${t.x}, ${t.y})`));k.append("circle").attr("r",(t=>o(t.linkCount))).style("fill",(t=>this.typeColors[t.type])).style("stroke","#fff").style("stroke-width","1.5px"),k.on("mouseover",((t,e)=>{const i=_.Ltv(t.currentTarget);i.select("circle").transition().duration(200).attr("r",(t=>1.5*o(t.linkCount))),d.selectAll(".link").filter((t=>t.source.id===e.id||t.target.id===e.id)).transition().duration(200).style("stroke-opacity",1).style("stroke-width",(t=>t.weight>.99?4*t.weight:2*t.weight));const n=_.Ltv("#subgraph-tooltip");n.style("display","block").html(`\n                                <div class="tooltip-content">\n                                    <div data-label="ID">id: ${e.id}</div>\n                                    <div data-label="Type">type: ${e.type||"Unknown"}</div>\n                                    <div data-label="Country">country: ${e.country||"N/A"}</div>\n                                    <div data-label="Connections">connections: ${e.linkCount}</div>\n                                </div>\n                            `).style("left",t.pageX+10+"px").style("top",t.pageY-10+"px")})).on("mouseout",((t,e)=>{const i=_.Ltv(t.currentTarget);i.select("circle").transition().duration(200).attr("r",(t=>o(t.linkCount))),d.selectAll(".link").filter((t=>t.source.id===e.id||t.target.id===e.id)).transition().duration(200).style("stroke-opacity",(t=>t.weight>.99?.8:.6)).style("stroke-width",(t=>t.weight>.99?3*t.weight:1.5*t.weight)),_.Ltv("#subgraph-tooltip").style("display","none")})),this.simulations[t]=null}))):console.warn("No data available for updating subgraphs")}},mounted(){this.initSubgraphs(),window.addEventListener("resize",this.handleResize)},beforeUnmount(){window.removeEventListener("resize",this.handleResize),Object.values(this.simulations).forEach((t=>{t&&t.stop()}))},watch:{filteredNodes:{handler(t,e){JSON.stringify(t)!==JSON.stringify(e)&&this.updateSubgraphs()},deep:!0},selectedNodeId:{handler(t){Object.values(this.svgs).forEach((e=>{e.selectAll(".node circle").transition().duration(200).style("stroke",(e=>e.id===t?"#FF0000":"#fff")).style("stroke-width",(e=>e.id===t?4:1.5)),e.selectAll(".link").transition().duration(200).style("stroke-opacity",(e=>{const i=e.source.id===t||e.target.id===t;return i?e.weight>.99?1:.9:e.weight>.99?.8:.6})).style("stroke",(e=>{const i=e.source.id===t||e.target.id===t;if(!i)return e.weight>.99?"#FF0000":this.linkColors[e.type];switch(e.type){case"membership":return"#6982B0";case"partnership":return"#5A8D6A";case"ownership":return"#8B6BA8";case"family_relationship":return"#8B7355";default:return"#666666"}})).style("stroke-width",(e=>{const i=e.source.id===t||e.target.id===t;return i?e.weight>.99?3*e.weight:2*e.weight:e.weight>.99?3*e.weight:1.5*e.weight}))}))}}}};const P=(0,F.A)(O,[["render",M],["__scopeId","data-v-63ea188a"]]);var H=P;const G={class:"network-container"},V={ref:"graphContainer",class:"network-graph"};function R(t,e,i,n,a,s){return(0,r.uX)(),(0,r.CE)("div",G,[(0,r.Lk)("div",V,null,512)])}i(116);var X={name:"TreeNetworkGraph",computed:{...(0,A.aH)(["selectedNodeId","originalNodes","originalLinks"])},data(){return{hierarchyData:null,levelNodeCounts:{},typeColors:{person:"#FFB6C1",organization:"#4ECDC4",company:"#45B7D1",political_organization:"#96CEB4",location:"#FFEEAD",vessel:"#D4A5A5",event:"#9B59B6",movement:"#3498DB",unknown:"#95A5A6"},linkColors:{membership:"#B0C4DE",partnership:"#A8D4B2",ownership:"#C7B8E0",family_relationship:"#C2B8A3"}}},async mounted(){try{const t="/VIS-Project",e=await fetch(`${t}/assets/tree_hierarchy.json`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);this.hierarchyData=await e.json(),this.renderTreeGraph()}catch(t){console.error("加载层级数据失败:",t)}},methods:{convertToD3Hierarchy(t){if(!t||0===t.length)return{name:this.selectedNodeId||"Root",children:[]};this.levelNodeCounts={};const e={name:t[0].name,depth:1,children:[],showLabel:!0},i={[e.name]:e},n=[...t].sort(((t,e)=>t.depth-e.depth));return n.forEach((t=>{if(1===t.depth)return;const e=t.path.slice(0,-1),n=e[e.length-1],r=i[n];if(r){this.levelNodeCounts[t.depth]||(this.levelNodeCounts[t.depth]=0),this.levelNodeCounts[t.depth]+=1;const e={name:t.name,depth:t.depth,children:[],showLabel:this.levelNodeCounts[t.depth]<=10};r.children.push(e),i[t.name]=e}})),e},getNodeType(t){const e=this.originalNodes.find((e=>e.id.toString()===t.toString())),i=e?e.type:"unknown";return i},getLinkType(t,e){const i=this.originalLinks.find((i=>i.source.toString()===t.toString()&&i.target.toString()===e.toString()||i.source.toString()===e.toString()&&i.target.toString()===t.toString()));return i?i.type:"unknown"},renderTreeGraph(){const t=this.$refs.graphContainer;if(_.Ltv(t).selectAll("*").remove(),!this.selectedNodeId||!this.hierarchyData){const e=_.Ltv(t).append("svg").attr("width","100%").attr("height","100%").style("background","#f9f9f9");return void e.append("text").attr("x","50%").attr("y","50%").attr("text-anchor","middle").attr("dominant-baseline","middle").style("font-size","16px").style("fill","#666").text(this.hierarchyData?"请选择一个节点":"正在加载数据...")}const e=this.hierarchyData[this.selectedNodeId];if(!e){const e=_.Ltv(t).append("svg").attr("width","100%").attr("height","100%").style("background","#f9f9f9");return void e.append("text").attr("x","50%").attr("y","50%").attr("text-anchor","middle").attr("dominant-baseline","middle").style("font-size","16px").style("fill","#666").text("该节点没有层级数据")}const i=this.convertToD3Hierarchy(e),n=t.clientWidth||1200,r=t.clientHeight||800,a=_.Ltv(t).append("svg").attr("width",n).attr("height",r).style("background","#f9f9f9"),s=a.append("g").attr("class","graph-container"),o=_.B22().size([.8*r,.8*n]).separation(((t,e)=>t.parent===e.parent?2:3)),l=_.Sk5(i);l.each((t=>{t.children&&(t.children.sort(((t,e)=>t.data.name.localeCompare(e.data.name))),t.children.length>15&&(t.children=t.children.slice(0,15)))}));const d=o(l);s.selectAll(".link").data(d.links()).enter().append("path").attr("class","link").attr("fill","none").attr("stroke",(t=>{const e=this.getLinkType(t.source.data.name,t.target.data.name);return this.linkColors[e]||"#aaa"})).attr("stroke-width",1.5).attr("stroke-dasharray",(function(t){return t.target.depth%2===0?"3,3":"none"})).attr("d",_.pqs().x((t=>t.y)).y((t=>t.x)));const c=s.selectAll(".node").data(d.descendants()).enter().append("g").attr("class","node").attr("transform",(t=>`translate(${t.y},${t.x})`));c.append("circle").attr("r",(t=>8-t.depth)).attr("fill",(t=>{const e=this.getNodeType(t.data.name);return this.typeColors[e]||this.typeColors["unknown"]})).attr("stroke","#fff").attr("stroke-width",1.5).style("cursor","pointer").on("mouseover",(function(t,e){_.Ltv(this).transition().duration(200).attr("r",1.5*(8-e.depth)).attr("stroke-width",2),_.Ltv(this.parentNode).select("text").transition().duration(200).style("opacity",1).style("font-weight","bold")})).on("mouseout",(function(t,e){_.Ltv(this).transition().duration(200).attr("r",8-e.depth).attr("stroke-width",1.5),e.children&&_.Ltv(this.parentNode).select("text").transition().duration(200).style("opacity",.7).style("font-weight","normal")})),c.append("text").attr("dy","0.31em").attr("x",(t=>t.children?-12:12)).attr("text-anchor",(t=>t.children?"end":"start")).text((t=>t.data.name)).attr("font-size",(t=>Math.max(12-1.5*t.depth,8))).style("opacity",(t=>t.children?.7:1)).style("pointer-events","none").style("text-shadow","0 0 2px white").style("font-family","Arial, sans-serif");const h=_.s_O().scaleExtent([.3,2]).on("zoom",(t=>{s.attr("transform",t.transform)}));a.call(h);const p=s.node().getBBox(),u=p.width,g=p.height,f=Math.min(n/u*.9,r/g*.9),m=(n-u*f)/2,y=(r-g*f)/2;a.call(h.transform,_.GSI.translate(m,y).scale(f))}},watch:{selectedNodeId:{handler(){this.renderTreeGraph()},immediate:!0}}};const U=(0,F.A)(X,[["render",R],["__scopeId","data-v-441639af"]]);var W=U;const Y={class:"parallel-coordinates-container"},J={ref:"chartContainer",class:"scatter-plot"};function K(t,e,i,n,a,s){return(0,r.uX)(),(0,r.CE)("div",Y,[(0,r.Lk)("div",J,null,512)])}i(3579);var q={name:"ParallelCoordinates",data(){return{coefData:null}},computed:{...(0,A.aH)(["selectedNodeId"])},async mounted(){try{const t="/VIS-Project",e=await fetch(`${t}/assets/nodes_coef.json`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);this.coefData=await e.json(),this.renderChart()}catch(t){console.error("加载系数数据失败:",t)}window.addEventListener("resize",this.handleResize)},beforeUnmount(){window.removeEventListener("resize",this.handleResize)},methods:{createTopTenScale(t,e,i){const n=_.T9B(t.filter((t=>!e.some((e=>e===t)))));return _.m4Y().domain([0,n,_.T9B(t)]).range([i[0],i[0]+.8*(i[1]-i[0]),i[1]]).clamp(!0)},renderChart(){const t=this.coefData;if(!t||0===t.length){const t=this.$refs.chartContainer;_.Ltv(t).selectAll("*").remove();const e=_.Ltv(t).append("svg").attr("width","100%").attr("height","100%").style("background","#f9f9f9");return void e.append("text").attr("x","50%").attr("y","50%").attr("text-anchor","middle").attr("dominant-baseline","middle").style("font-size","16px").style("fill","#666").text("正在加载数据...")}_.Ltv(this.$refs.chartContainer).selectAll("*").remove();const e=t.map(((t,e)=>({...t,originalIndex:e}))).sort(((t,e)=>e.raw_score-t.raw_score)).slice(0,10).map((t=>t.id)),i=t.map(((t,e)=>({...t,originalIndex:e}))).sort(((t,e)=>e.norm_score-t.norm_score)).slice(0,10).map((t=>t.id)),n=this.$refs.chartContainer,r=n.clientWidth||800,a=n.clientHeight||600,s={top:60,right:60,bottom:10,left:60},o=_.Ltv(n).append("svg").attr("width",r).attr("height",a).style("background","#f9f9f9"),l=t.map((t=>t.raw_score)),d=t.map((t=>t.norm_score)),c=this.createTopTenScale(l,e.map((e=>t.find((t=>t.id===e)).raw_score)),[a-s.bottom,s.top]),h=this.createTopTenScale(d,i.map((e=>t.find((t=>t.id===e)).norm_score)),[a-s.bottom,s.top]),p=_.hqK().domain(t.map((t=>t.id))).range([s.left,r-s.right]),u=_.UMr().domain(["normal","top-raw","top-norm"]).range(["#999","#ff4d4d","#4daf4d"]);o.selectAll(".connection-line").data(t).enter().append("line").attr("data-id",(t=>String(t.id))).attr("x1",(t=>p(t.id))).attr("y1",(t=>c(t.raw_score))).attr("x2",(t=>p(t.id))).attr("y2",(t=>h(t.norm_score))).attr("stroke",(t=>e.includes(t.id)||i.includes(t.id)?u("top-raw"):"#ddd")).attr("stroke-width",1).attr("opacity",.5),o.selectAll(".dot-norm").data(t).enter().append("circle").attr("class","dot-norm").attr("data-id",(t=>String(t.id))).attr("cx",(t=>p(t.id))).attr("cy",(t=>h(t.norm_score))).attr("r",1).attr("fill",(t=>i.includes(t.id)?u("top-norm"):u("normal"))).attr("opacity",.7),o.selectAll(".dot-raw").data(t).enter().append("circle").attr("class","dot-raw").attr("data-id",(t=>String(t.id))).attr("cx",(t=>p(t.id))).attr("cy",(t=>c(t.raw_score))).attr("r",(t=>e.includes(t.id)?2:1)).attr("fill",(t=>e.includes(t.id)?u("top-raw"):u("normal"))).attr("opacity",.7);const g="#666";o.append("g").attr("transform",`translate(${s.left},0)`).call(_.V4s(c).ticks(5)).call((t=>t.select(".domain").attr("stroke",g))).call((t=>t.selectAll(".tick line").attr("stroke",g))).call((t=>t.selectAll(".tick text").attr("fill",g))).append("text").attr("transform","rotate(-90)").attr("y",-40).attr("x",-a/2).attr("text-anchor","middle").text("Raw Score").style("fill",g),o.append("g").attr("transform",`translate(${r-s.right},0)`).call(_.eH3(h).ticks(5)).call((t=>t.select(".domain").attr("stroke",g))).call((t=>t.selectAll(".tick line").attr("stroke",g))).call((t=>t.selectAll(".tick text").attr("fill",g))).append("text").attr("transform","rotate(-90)").attr("y",40).attr("x",-a/2).attr("text-anchor","middle").text("Normalized Score").style("fill",g);const f=o.append("g").attr("transform",`translate(${r-s.right+10}, ${s.top})`);f.append("circle").attr("cx",2*-r/3+30).attr("cy",-a/10).attr("r",3).attr("fill",u("top-raw")),f.append("text").attr("x",2*-r/3+10+30).attr("y",-a/10+4).text("Top 10 Points").style("font-size","10px"),f.append("circle").attr("cx",1*-r/3+30).attr("cy",-a/10).attr("r",3).attr("fill",u("normal")),f.append("text").attr("x",1*-r/3+10+30).attr("y",-a/10+4).text("Other points").style("font-size","10px")},highlightNode(t){const e=this.coefData;if(!e||0===e.length)return;const i=_.Ltv(this.$refs.chartContainer).select("svg");i.selectAll(".node-info-box").remove();const n=this.coefData.find((e=>String(e.id)===String(t)));if(!n)return;const r=e.map(((t,e)=>({...t,originalIndex:e}))).sort(((t,e)=>e.raw_score-t.raw_score)).slice(0,10).map((t=>t.id)),a=_.UMr().domain(["normal","top-raw","top-norm"]).range(["#999","#ff4d4d","#4daf4d"]);i.selectAll("[data-id]").each((function(){const t=_.Ltv(this);(t.classed("dot-raw")||t.classed("dot-norm"))&&t.attr("r",1).attr("fill","#999").attr("opacity",.5).attr("r",(t=>r.includes(t.id)?2:1)).attr("fill",(t=>r.includes(t.id)?a("top-raw"):a("normal"))),t.classed("connection-line")&&t.attr("stroke","#ddd").attr("stroke-width",1).attr("opacity",.3)}));const s=i.selectAll(`[data-id="${t}"].dot-raw, [data-id="${t}"].dot-norm`).filter((function(t,e){return 0===e}));if(s.empty())return;s.attr("r",4).attr("fill","#40E0D0").attr("opacity",1);const o=i.select(`[data-id="${t}"].connection-line`);o.empty()||o.attr("stroke","#40E0D0").attr("stroke-width",2).attr("opacity",1);const l=parseFloat(s.attr("cx")),d=parseFloat(s.attr("cy")),c=i.append("g").attr("class","node-info-box").attr("transform",`translate(${l+10}, ${d-40})`);c.append("rect").attr("width",130).attr("height",70).attr("fill","white").attr("stroke","#333").attr("stroke-width",1).attr("rx",5).attr("ry",5).attr("opacity",.6);const h=[`ID: ${n.id}`,`Raw Score: ${n.raw_score.toFixed(2)}`,`Norm Score: ${n.norm_score.toFixed(2)}`];c.selectAll("text").data(h).enter().append("text").attr("x",10).attr("y",((t,e)=>20+18*e)).attr("font-size","10px").text((t=>t))}},watch:{selectedNodeId:{handler(t){const e=String(t);this.highlightNode(e)},immediate:!0}}};const Q=(0,F.A)(q,[["render",K],["__scopeId","data-v-2c4b0711"]]);var Z=Q;const tt="/VIS-Project";var et={name:"App",components:{FilterPanel:S,FDG:I,SubGraphs:H,NetworkGraph:W,ParallelCoordinates:Z},setup(){const t=(0,A.Pj)();return{store:t}},async mounted(){console.log("App 组件挂载，开始加载数据...");try{await this.store.dispatch("loadData");const t=await fetch(`${tt}/assets/nodes_coef.json`);this.coefData=await t.json(),console.log("数据加载完成")}catch(t){console.error("数据加载失败:",t)}}};const it=(0,F.A)(et,[["render",m]]);var nt=it,rt=(0,A.y$)({state:{originalNodes:[],originalLinks:[],filteredNodes:[],filteredLinks:[],countries:[],filterConditions:{nodeTypes:[],countries:[],relations:[]},selectedNodeId:null},mutations:{setOriginalData(t,{nodes:e,links:i}){t.originalNodes=e,t.originalLinks=i},setFilteredData(t,{nodes:e,links:i}){t.filteredNodes=e,t.filteredLinks=i},setFilterConditions(t,e){t.filterConditions={...t.filterConditions,...e}},setCountries(t,e){t.countries=e},setSelectedNodeId(t,e){t.selectedNodeId=e}},actions:{async loadData({commit:t,dispatch:e}){try{console.log("开始加载数据...");const i="/VIS-Project",n=await fetch(`${i}/assets/mc1_clean.json`);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const r=await n.json();if(console.log("节点数据加载成功，节点数量:",r.nodes.length),console.log("连接数据加载成功，连接数量:",r.links.length),!Array.isArray(r.nodes)||!Array.isArray(r.links))throw new Error("数据格式错误：nodes 和 links 必须是数组");t("setOriginalData",{nodes:r.nodes,links:r.links}),t("setFilterConditions",{nodeTypes:["person","organization"],countries:[]});const a=await fetch(`${i}/assets/country_counts.csv`);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const s=await a.text(),o=s.split("\n").slice(1).filter((t=>t.trim())).map((t=>{const[e,i]=t.split(",");return{value:e,label:`${e} (${i})`}}));console.log("国家数据加载成功，数量:",o.length),t("setCountries",o),t("setFilterConditions",{countries:o.map((t=>t.value))}),e("applyFilters"),console.log("所有数据已成功提交到 store")}catch(i){console.error("加载数据失败:",i),console.error("错误详情:",i.message),i.stack&&console.error("错误堆栈:",i.stack)}},applyFilters({state:t,commit:e}){const{nodeTypes:i,countries:n}=t.filterConditions;console.log("应用筛选条件:",{nodeTypes:i,countries:n});const r=n.length===t.countries.length;console.log("是否选择所有国家:",r);const a={};t.originalLinks.forEach((t=>{const e="object"===typeof t.source?t.source.id:t.source,i="object"===typeof t.target?t.target.id:t.target;a[e]=(a[e]||0)+1,a[i]=(a[i]||0)+1}));const s=t.originalNodes.filter((t=>{const e=a[t.id]||0,s=e>=5,o=i.includes(t.type),l=r||0===n.length||n.includes(t.country);return!!(s&&o&&l)&&(t.linkCount=e,!0)})),o=new Set(s.map((t=>t.id))),l=t.originalLinks.filter((t=>{const e="object"===typeof t.source?t.source.id:t.source,i="object"===typeof t.target?t.target.id:t.target;return o.has(e)&&o.has(i)}));console.log("筛选后的数据:",{nodes:s.length,links:l.length,removedNodes:t.originalNodes.length-s.length,removedLinks:t.originalLinks.length-l.length}),e("setFilteredData",{nodes:s,links:l})}}}),at=i(271),st=(i(4188),i(5090));const ot=(0,n.Ef)(nt);ot.use(rt),ot.use(at.A),ot.config.globalProperties.$echarts=st,ot.mount("#app")}},e={};function i(n){var r=e[n];if(void 0!==r)return r.exports;var a=e[n]={exports:{}};return t[n].call(a.exports,a,a.exports,i),a.exports}i.m=t,function(){var t=[];i.O=function(e,n,r,a){if(!n){var s=1/0;for(c=0;c<t.length;c++){n=t[c][0],r=t[c][1],a=t[c][2];for(var o=!0,l=0;l<n.length;l++)(!1&a||s>=a)&&Object.keys(i.O).every((function(t){return i.O[t](n[l])}))?n.splice(l--,1):(o=!1,a<s&&(s=a));if(o){t.splice(c--,1);var d=r();void 0!==d&&(e=d)}}return e}a=a||0;for(var c=t.length;c>0&&t[c-1][2]>a;c--)t[c]=t[c-1];t[c]=[n,r,a]}}(),function(){i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,{a:e}),e}}(),function(){i.d=function(t,e){for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){var t={524:0};i.O.j=function(e){return 0===t[e]};var e=function(e,n){var r,a,s=n[0],o=n[1],l=n[2],d=0;if(s.some((function(e){return 0!==t[e]}))){for(r in o)i.o(o,r)&&(i.m[r]=o[r]);if(l)var c=l(i)}for(e&&e(n);d<s.length;d++)a=s[d],i.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return i.O(c)},n=self["webpackChunkvis_project"]=self["webpackChunkvis_project"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();var n=i.O(void 0,[504],(function(){return i(5114)}));n=i.O(n)})();
//# sourceMappingURL=app.8eaa38c6.js.map